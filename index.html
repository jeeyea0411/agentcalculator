<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CS ìƒë‹´ì› ì¸ë ¥ ì‚°ì • ê³„ì‚°ê¸°</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§®</text></svg>">
  <link rel="stylesheet" href="https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: linear-gradient(145deg, #080c12 0%, #0c1929 30%, #0f1f35 60%, #0a1628 100%);
      font-family: 'Spoqa Han Sans Neo', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #e0e8f0;
      padding: 24px;
    }
    input[type="number"]::-webkit-inner-spin-button { opacity: 1; }
    input:focus, select:focus { outline: none; border-color: #3b82f6 !important; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
    .card { background: rgba(255,255,255,0.02); backdrop-filter: blur(20px); border: 1px solid rgba(59, 130, 246, 0.12); border-radius: 16px; }
    .glow { box-shadow: 0 0 50px rgba(59, 130, 246, 0.12), 0 0 100px rgba(30, 64, 175, 0.1); }
    .btn { transition: all 0.2s ease; cursor: pointer; }
    .btn:hover { transform: translateY(-2px); }
    .btn:disabled { cursor: not-allowed; transform: none; }
    .tag { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.25); border-radius: 20px; font-size: 13px; color: #e0e8f0; }
    .progress-bar { height: 8px; background: rgba(255,255,255,0.08); border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #2563eb, #3b82f6, #60a5fa); border-radius: 4px; transition: width 0.3s ease; }
    .container { max-width: 960px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 32px; }
    .header h1 { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #fff, #93c5fd); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header p { color: #a1a1aa; margin-top: 8px; font-size: 14px; }
    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .input-group label { font-size: 12px; color: #a1a1aa; display: block; margin-bottom: 6px; }
    .input-group input { width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: #fff; font-size: 15px; }
    .input-select { width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: #fff; font-size: 15px; cursor: pointer; }
    .input-select option { background: #1a2332; color: #fff; }
    .lang-select-row { display: flex; align-items: center; gap: 12px; }
    .btn-lang-select { padding: 12px 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; color: #60a5fa; font-size: 14px; cursor: pointer; white-space: nowrap; }
    .btn-lang-select:hover { background: rgba(59, 130, 246, 0.2); }
    .lang-selected-preview { font-size: 13px; color: #9ca3af; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .btn-calculate { padding: 14px 48px; background: linear-gradient(135deg, #10b981, #34d399); border: none; border-radius: 12px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .btn-calculate:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3); }
    .btn-small { padding: 6px 12px; font-size: 12px; }
    .lang-select-tags { display: flex; flex-wrap: wrap; gap: 8px; }
    .lang-select-tag { padding: 8px 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; color: #a1a1aa; font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .lang-select-tag:hover { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); }
    .lang-select-tag.selected { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; color: #4ade80; }
    .btn-row { display: flex; gap: 12px; margin-top: 20px; }
    .btn-secondary { padding: 8px 16px; background: transparent; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #a1a1aa; font-size: 13px; }
    .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .result-card { padding: 20px; }
    .result-card-header { font-size: 13px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .result-card-header.green { color: #10b981; }
    .result-card-header.blue { color: #3b82f6; }
    .result-inner-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .result-box { text-align: center; padding: 12px; border-radius: 10px; }
    .result-box.green { background: rgba(16, 185, 129, 0.1); }
    .result-box.green-dark { background: rgba(16, 185, 129, 0.15); }
    .result-box.blue { background: rgba(59, 130, 246, 0.1); }
    .result-box.blue-dark { background: rgba(59, 130, 246, 0.15); }
    .result-box-label { font-size: 11px; color: #a1a1aa; margin-bottom: 4px; }
    .result-box-value { font-size: 20px; font-weight: 700; }
    .result-box-value.green { color: #34d399; }
    .result-box-value.blue { color: #60a5fa; }
    .result-box-value.white { color: #fff; font-size: 24px; }
    .result-box-unit { font-size: 10px; color: #9ca3af; }
    .change-summary { padding: 16px; margin-bottom: 20px; background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.2); }
    .change-summary-inner { display: flex; align-items: center; justify-content: center; gap: 16px; }
    .change-item { text-align: center; min-width: 80px; }
    .change-item-label { font-size: 12px; color: #a1a1aa; margin-bottom: 4px; }
    .change-item-value { font-size: 22px; font-weight: 700; line-height: 1; }
    .change-item-value.green { color: #34d399; }
    .change-item-value.blue { color: #3b82f6; }
    .change-arrow { font-size: 20px; color: #9ca3af; line-height: 1; margin-top: 16px; }
    .change-badge { padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; margin-top: 16px; }
    .change-badge.positive { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
    .change-badge.negative { background: rgba(239, 68, 68, 0.15); color: #f87171; }
    .lang-section { padding: 24px; }
    .lang-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .lang-header h2 { font-size: 16px; font-weight: 600; }
    .lang-header-right { display: flex; align-items: center; gap: 12px; }
    .lang-total { font-size: 13px; font-weight: 500; }
    .lang-total.valid { color: #34d399; }
    .lang-total.invalid { color: #f97316; }
    .btn-primary { padding: 8px 16px; background: linear-gradient(135deg, #2563eb, #3b82f6); border: none; border-radius: 8px; color: #fff; font-size: 13px; font-weight: 500; }
    .btn-suggest { padding: 8px 16px; background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; color: #4ade80; font-size: 13px; font-weight: 500; }
    .btn-suggest:hover { background: rgba(34, 197, 94, 0.25); }
    .lang-col-header { display: flex; align-items: center; gap: 16px; padding: 8px 16px; margin-bottom: 8px; font-size: 11px; color: #a1a1aa; }
    .lang-row { display: flex; align-items: center; gap: 16px; padding: 12px 16px; background: rgba(255,255,255,0.02); border-radius: 10px; margin-bottom: 12px; }
    .lang-flag { font-size: 24px; width: 36px; line-height: 1; display: flex; align-items: center; position: relative; top: -2px; }
    .lang-name { width: 130px; font-weight: 500; display: flex; align-items: center; }
    .lang-progress { flex: 1; }
    .lang-input { width: 60px; padding: 6px 8px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px; text-align: center; }
    .lang-percent { color: #9ca3af; width: 16px; }
    .lang-percentage-text { width: 70px; font-size: 14px; font-weight: 500; color: #e0e8f0; text-align: center; }
    .lang-agents { width: 60px; text-align: center; }
    .lang-agents-value { font-size: 16px; font-weight: 600; }
    .lang-agents-value.green { color: #34d399; }
    .lang-agents-value.blue { color: #60a5fa; }
    .lang-agents-unit { font-size: 10px; color: #9ca3af; margin-left: 2px; }
    .lang-arrow { color: #9ca3af; font-size: 12px; width: 12px; }
    .lang-vendor { width: 100px; text-align: center; font-size: 12px; color: #f59e0b; }
    .lang-vendor-agents { width: 80px; text-align: center; font-size: 12px; color: #fbbf24; }
    .btn-remove { width: 28px; height: 28px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 14px; }
    .lang-empty { text-align: center; padding: 40px; color: #9ca3af; }
    .ai-section { padding: 24px; margin-top: 20px; }
    .ai-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .ai-header h2 { font-size: 16px; font-weight: 600; }
    .btn-ai { padding: 10px 20px; background: linear-gradient(135deg, #8b5cf6, #a855f7); border: none; border-radius: 8px; color: #fff; font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
    .btn-ai:disabled { background: rgba(100, 116, 139, 0.3); }
    .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .ai-placeholder { text-align: center; padding: 40px; color: #9ca3af; background: rgba(139, 92, 246, 0.05); border-radius: 12px; border: 1px dashed rgba(139, 92, 246, 0.2); }
    .ai-placeholder-icon { font-size: 32px; margin-bottom: 12px; }
    .ai-placeholder-text { font-size: 14px; }
    .ai-placeholder-sub { font-size: 12px; color: #9ca3af; margin-top: 8px; }
    .ai-loading { text-align: center; padding: 60px; color: #a78bfa; font-size: 14px; }
    .ai-result { padding: 20px; background: rgba(139, 92, 246, 0.05); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.15); font-size: 14px; line-height: 1.7; white-space: pre-wrap; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .modal { width: 520px; max-height: 80vh; padding: 24px; overflow: auto; background: linear-gradient(145deg, #1a2332 0%, #151d2a 100%); border: 1px solid rgba(59, 130, 246, 0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 40px rgba(59, 130, 246, 0.15); }
    .modal h3 { margin: 0 0 20px; font-size: 18px; }
    .modal-section { margin-bottom: 24px; }
    .modal-section-title { font-size: 13px; color: #a1a1aa; margin-bottom: 12px; }
    .preset-tags { display: flex; flex-wrap: wrap; gap: 8px; }
    .modal-divider { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
    .custom-input-row { display: flex; gap: 12px; }
    .custom-flag-input { width: 70px; padding: 10px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 18px; text-align: center; }
    .custom-name-input { flex: 1; padding: 10px 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 14px; }
    .btn-close { width: 100%; margin-top: 20px; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #a1a1aa; cursor: pointer; }
    .footer { text-align: center; margin-top: 32px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); }
    .footer-sub { color: #9ca3af; font-size: 12px; margin-bottom: 8px; }
    .footer-credit { color: #64748b; font-size: 13px; font-weight: 500; letter-spacing: 0.5px; }
    .reference-section { margin-top: 16px; padding: 16px; background: rgba(59, 130, 246, 0.05); border-radius: 10px; border: 1px solid rgba(59, 130, 246, 0.2); display: none; }
    .reference-section.show { display: block; }
    .reference-title { font-size: 13px; font-weight: 600; margin-bottom: 12px; color: #93c5fd; }
    .reference-table { width: 100%; font-size: 12px; border-collapse: collapse; }
    .reference-table th { text-align: left; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); color: #a1a1aa; }
    .reference-table th.right { text-align: right; }
    .reference-table th.green { color: #34d399; }
    .reference-table th.blue { color: #60a5fa; }
    .reference-table td { padding: 8px 0; }
    .reference-table td.right { text-align: right; }
    .reference-table td.blue { color: #93c5fd; }
    .reference-table td.green { color: #34d399; }
    .reference-table td.light-blue { color: #60a5fa; }
    .reference-note { font-size: 11px; color: #9ca3af; margin-top: 12px; }
    .settings-section { margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 10px; display: none; }
    .settings-section.show { display: block; }
    .settings-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    .settings-item label { font-size: 11px; color: #9ca3af; display: block; }
    .settings-item input { width: 100%; margin-top: 4px; padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 14px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>CS ìƒë‹´ì› ì¸ë ¥ ì‚°ì • ê³„ì‚°ê¸°</h1>
      <p>ì˜ˆìƒ MAUì™€ ì–¸ì–´ë³„ ìœ ì € ë¹„ì¤‘ì„ ì…ë ¥í•˜ë©´ í•„ìš” ì¸ì›ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>
    </div>

    <!-- Main Input Card -->
    <div class="card glow" style="padding: 24px; margin-bottom: 20px;">
      <div class="input-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="input-group">
          <label>ê²Œì„ëª…</label>
          <input type="text" id="gameName" value="íŒ°ì›”ë“œ ëª¨ë°”ì¼">
        </div>
        <div class="input-group">
          <label>ì˜ˆìƒ MAU</label>
          <input type="text" id="mau" value="1,000,000" inputmode="numeric">
        </div>
      </div>
      
      <div class="input-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="input-group">
          <label>ê¸°ì¤€ ê²Œì„</label>
          <select id="baseGame" class="input-select">
            <option value="newstate">NEW STATE</option>
            <option value="defensederby">Defense Derby</option>
            <option value="aod">AOD</option>
          </select>
        </div>
        <div class="input-group">
          <label>ì§€ì› ì–¸ì–´</label>
          <div class="lang-select-row">
            <button class="btn btn-lang-select" id="openLangSelect">ğŸŒ ì–¸ì–´ ì„ íƒ</button>
            <span class="lang-selected-preview" id="langPreview">ì„ íƒëœ ì–¸ì–´ ì—†ìŒ</span>
          </div>
        </div>
      </div>

      <div class="btn-row" style="justify-content: center; margin-top: 24px;">
        <button class="btn btn-calculate" id="calculateBtn">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
      </div>

      <div class="btn-row" style="justify-content: center; margin-top: 12px;">
        <button class="btn btn-secondary btn-small" id="toggleSettings">âš™ï¸ ê¸°ì¤€ê°’ ì„¤ì • â–¼</button>
        <button class="btn btn-secondary btn-small" id="toggleReference">ğŸ“Š ì°¸ê³  ë°ì´í„° â–¼</button>
      </div>

      <!-- Reference Data -->
      <div class="reference-section" id="referenceSection">
        <div class="reference-title">ğŸ“Š ê³„ì‚° ê¸°ì¤€ ì°¸ê³  ë°ì´í„°</div>
        <table class="reference-table">
          <thead>
            <tr>
              <th>ê²Œì„</th>
              <th class="right">MAU</th>
              <th class="right green">ì´ˆë°˜ í‹°ì¼“</th>
              <th class="right blue">ì•ˆì •ê¸° í‹°ì¼“</th>
              <th class="right">ìƒë‹´ì›</th>
              <th class="right green">ì´ˆë°˜ ë°œìƒë¥ </th>
              <th class="right blue">ì•ˆì •ê¸° ë°œìƒë¥ </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Defense Derby</td>
              <td class="right blue">682,384</td>
              <td class="right">465</td>
              <td class="right">653</td>
              <td class="right">6ëª…</td>
              <td class="right green">0.068%</td>
              <td class="right light-blue">0.096%</td>
            </tr>
            <tr>
              <td>Abyss of Dungeons</td>
              <td class="right blue">634,988</td>
              <td class="right">1,330</td>
              <td class="right">295</td>
              <td class="right">8ëª…</td>
              <td class="right green">0.210%</td>
              <td class="right light-blue">0.046%</td>
            </tr>
          </tbody>
        </table>
        <div class="reference-note" id="referenceNote">
          * í˜„ì¬ ê³„ì‚° ê¸°ì¤€: ëŸ°ì¹­ ì´ˆë°˜ 0.14%, ì•ˆì •ê¸° 0.07%, ìƒë‹´ì› 1ì¸ ì¼ 100ê±´ ì²˜ë¦¬ (ì›” 22ì¼ ê·¼ë¬´)
        </div>
      </div>

      <!-- Settings -->
      <div class="settings-section" id="settingsSection">
        <div class="settings-grid">
          <div class="settings-item">
            <label>ëŸ°ì¹­ ì´ˆë°˜ í‹°ì¼“ ë°œìƒë¥  (%)</label>
            <input type="number" step="0.01" id="ticketRateEarly" value="1.17">
          </div>
          <div class="settings-item">
            <label>ì•ˆì •ê¸° í‹°ì¼“ ë°œìƒë¥  (%)</label>
            <input type="number" step="0.01" id="ticketRateStable" value="0.43">
          </div>
          <div class="settings-item">
            <label>ìƒë‹´ì› 1ì¸ ì¼ ì²˜ë¦¬ëŸ‰ (ê±´)</label>
            <input type="number" id="ticketsPerDay" value="100">
          </div>
          <div class="settings-item">
            <label>ì›” ê·¼ë¬´ì¼ìˆ˜</label>
            <input type="number" id="workingDays" value="22">
          </div>
        </div>
      </div>
    </div>

    <!-- Results Section (ìˆ¨ê¹€ ìƒíƒœë¡œ ì‹œì‘) -->
    <div id="resultsSection" class="hidden">
    <div class="results-grid">
      <!-- ëŸ°ì¹­ ì´ˆë°˜ -->
      <div class="card result-card">
        <div class="result-card-header green">
          <span style="font-size: 18px;">ğŸš€</span> ëŸ°ì¹­ ì´ˆë°˜ (1~2ê°œì›”)
        </div>
        <div class="result-inner-grid">
          <div class="result-box green">
            <div class="result-box-label">ì˜ˆìƒ í‹°ì¼“</div>
            <div class="result-box-value green" id="earlyTickets">1,400</div>
            <div class="result-box-unit">ê±´/ì›”</div>
          </div>
          <div class="result-box green-dark">
            <div class="result-box-label">í•„ìš” ì¸ì›</div>
            <div class="result-box-value white" id="earlyAgents">3</div>
            <div class="result-box-unit">ëª…</div>
          </div>
        </div>
      </div>

      <!-- ì•ˆì •ê¸° -->
      <div class="card glow result-card">
        <div class="result-card-header blue">
          <span style="font-size: 18px;">ğŸ“Š</span> ì•ˆì •ê¸° (3ê°œì›” í›„~)
        </div>
        <div class="result-inner-grid">
          <div class="result-box blue">
            <div class="result-box-label">ì˜ˆìƒ í‹°ì¼“</div>
            <div class="result-box-value blue" id="stableTickets">700</div>
            <div class="result-box-unit">ê±´/ì›”</div>
          </div>
          <div class="result-box blue-dark">
            <div class="result-box-label">í•„ìš” ì¸ì›</div>
            <div class="result-box-value white" id="stableAgents">3</div>
            <div class="result-box-unit">ëª…</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Change Summary -->
    <div class="card change-summary">
      <div class="change-summary-inner">
        <div class="change-item">
          <div class="change-item-label">ëŸ°ì¹­ ì´ˆë°˜</div>
          <div class="change-item-value green" id="summaryEarly">3ëª…</div>
        </div>
        <div class="change-arrow">â†’</div>
        <div class="change-item">
          <div class="change-item-label">ì•ˆì •ê¸°</div>
          <div class="change-item-value blue" id="summaryStable">3ëª…</div>
        </div>
        <div class="change-badge positive" id="changeBadge">0ëª… ì¶•ì†Œ ê°€ëŠ¥</div>
      </div>
    </div>

    <!-- Language Breakdown -->
    <div class="card lang-section">
      <div class="lang-header">
        <h2>ğŸŒ ì–¸ì–´ë³„ ìƒë‹´ì› ë°°ë¶„</h2>
        <div class="lang-header-right">
          <span class="lang-total valid" id="langTotal">í•©ê³„: 100%</span>
        </div>
      </div>

      <!-- Column Header -->
      <div class="lang-col-header">
        <span style="width: 36px;"></span>
        <span style="width: 130px;">ì–¸ì–´</span>
        <span style="flex: 1;">ë¹„ì¤‘</span>
        <span style="width: 50px;"></span>
        <span style="width: 16px;"></span>
        <span style="width: 60px; text-align: center; color: #34d399;">ì´ˆë°˜</span>
        <span style="width: 12px;"></span>
        <span style="width: 60px; text-align: center; color: #60a5fa;">ì•ˆì •ê¸°</span>
        <span style="width: 100px; text-align: center; color: #f59e0b;">ì™¸ì£¼ì‚¬</span>
        <span style="width: 80px; text-align: center; color: #f59e0b;">ì™¸ì£¼ì‚¬ ì¸ì›</span>
      </div>

      <div id="languageList"></div>

      <div class="lang-empty" id="langEmpty">ì–¸ì–´ë¥¼ ì„ íƒí•˜ê³  ê³„ì‚°í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
    </div>

    <!-- AI Analysis Section -->
    <div class="card ai-section">
      <div class="ai-header">
        <h2>ğŸ¤– AI ë¶„ì„</h2>
        <button class="btn btn-ai" id="analyzeBtn">âœ¨ ê²°ê³¼ ë¶„ì„í•˜ê¸°</button>
      </div>

      <div class="ai-placeholder" id="aiPlaceholder">
        <div class="ai-placeholder-icon">ğŸ”®</div>
        <div class="ai-placeholder-text">ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ Claude AIê°€ ê³„ì‚° ê²°ê³¼ë¥¼ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤</div>
        <div class="ai-placeholder-sub">ì¸ë ¥ ë°°ì¹˜ ì „ëµ, ë¦¬ìŠ¤í¬ ë¶„ì„, ë¹„ìš© ìµœì í™” íŒ ë“±ì„ ì œê³µí•©ë‹ˆë‹¤</div>
      </div>

      <div class="ai-loading hidden" id="aiLoading">Claudeê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>

      <div class="ai-result hidden" id="aiResult"></div>
    </div>
    </div><!-- resultsSection ë -->

    <!-- Language Select Modal -->
    <div class="modal-overlay hidden" id="langSelectModal">
      <div class="card modal">
        <h3>ì§€ì› ì–¸ì–´ ì„ íƒ</h3>
        <p style="color: #9ca3af; font-size: 13px; margin-bottom: 16px;">í´ë¦­í•˜ì—¬ ì„ íƒ/í•´ì œ</p>
        
        <div class="modal-section">
          <div class="lang-select-tags" id="langSelectTags"></div>
        </div>

        <div class="modal-divider">
          <div class="modal-section-title">ì§ì ‘ ì…ë ¥</div>
          <div class="custom-input-row">
            <input type="text" class="custom-flag-input" id="customFlagSelect" placeholder="ğŸ³ï¸" value="ğŸ³ï¸">
            <input type="text" class="custom-name-input" id="customNameSelect" placeholder="ì–¸ì–´ëª… (ì˜ˆ: í´ë€ë“œì–´)">
            <button class="btn btn-primary" id="addCustomSelectBtn">ì¶”ê°€</button>
          </div>
        </div>

        <button class="btn-close" id="closeLangSelectBtn">í™•ì¸</button>
      </div>
    </div>

    <!-- Language Modal (ê¸°ì¡´ - ë¹„ì¤‘ ì¡°ì •ìš©) -->
    <div class="modal-overlay hidden" id="langModal">
      <div class="card modal">
        <h3>ì–¸ì–´ ì¶”ê°€</h3>
        
        <div class="modal-section">
          <div class="modal-section-title">í”„ë¦¬ì…‹ ì–¸ì–´</div>
          <div class="preset-tags" id="presetTags"></div>
        </div>

        <div class="modal-divider">
          <div class="modal-section-title">ì§ì ‘ ì…ë ¥</div>
          <div class="custom-input-row">
            <input type="text" class="custom-flag-input" id="customFlag" placeholder="ğŸ³ï¸" value="ğŸ³ï¸">
            <input type="text" class="custom-name-input" id="customName" placeholder="ì–¸ì–´ëª… (ì˜ˆ: í´ë€ë“œì–´)">
            <button class="btn btn-primary" id="addCustomBtn">ì¶”ê°€</button>
          </div>
        </div>

        <button class="btn-close" id="closeModalBtn">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer-sub">ê³„ì‚° ê¸°ì¤€: NEW STATE, Defense Derby, Abyss of Dungeons ì‹¤ì œ ìš´ì˜ ë°ì´í„° ê¸°ë°˜</div>
      <div class="footer-credit">Made by JEEYEA CHA</div>
    </div>
  </div>

  <script>
    // ê²Œì„ë³„ í‹°ì¼“ ë°œìƒë¥  ë°ì´í„°
    const GAME_DATA = {
      newstate: { name: 'NEW STATE', earlyRate: 0.0117, stableRate: 0.0043 },
      defensederby: { name: 'Defense Derby', earlyRate: 0.0014, stableRate: 0.0007 },
      aod: { name: 'AOD', earlyRate: 0.0018, stableRate: 0.0018 },
    };

    // ì„¤ì •
    const config = {
      ticketRateEarly: 0.0117,
      ticketRateStable: 0.0043,
      ticketsPerAgentPerDay: 100,
      workingDaysPerMonth: 22
    };

    // í”„ë¦¬ì…‹ ì–¸ì–´ (NEW STATE + Defense Derby + AOD í‰ê·  ë¹„ì¤‘, 2ê°œ ì´ìƒ ê²Œì„ ë°ì´í„° ìˆëŠ” ì–¸ì–´ë§Œ)
    const PRESET_LANGUAGES = [
      { code: 'en', name: 'ì˜ì–´', flag: 'ğŸ‡ºğŸ‡¸', baseRatio: 24.3 },
      { code: 'hi', name: 'íŒë””ì–´', flag: 'ğŸ‡®ğŸ‡³', baseRatio: 23.0 },
      { code: 'id', name: 'ì¸ë„ë„¤ì‹œì•„ì–´', flag: 'ğŸ‡®ğŸ‡©', baseRatio: 13.0 },
      { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·', baseRatio: 12.6 },
      { code: 'pt-BR', name: 'í¬ë¥´íˆ¬ê°ˆì–´ (ë¸Œë¼ì§ˆ)', flag: 'ğŸ‡§ğŸ‡·', baseRatio: 12.6 },
      { code: 'zh-TW', name: 'ì¤‘êµ­ì–´ ë²ˆì²´', flag: 'ğŸ‡¹ğŸ‡¼', baseRatio: 5.3 },
      { code: 'th', name: 'íƒœêµ­ì–´', flag: 'ğŸ‡¹ğŸ‡­', baseRatio: 4.2 },
      { code: 'ja', name: 'ì¼ë³¸ì–´', flag: 'ğŸ‡¯ğŸ‡µ', baseRatio: 3.1 },
      { code: 'es-MX', name: 'ìŠ¤í˜ì¸ì–´ (ë‚¨ë¯¸)', flag: 'ğŸ‡²ğŸ‡½', baseRatio: 2.8 },
    ];

    // ì™¸ì£¼ì‚¬ë³„ ë‹´ë‹¹ ì–¸ì–´
    const VENDOR_DATA = {
      'Meta-M': ['ko'],
      'Ubase': ['en', 'id', 'th', 'ms', 'zh-TW', 'tr', 'ar'],
      'Keywords': ['en', 'hi', 'ja', 'fr', 'ru', 'es-MX', 'pt-BR', 'de'],
    };

    // ì–¸ì–´ ì½”ë“œë¡œ ì™¸ì£¼ì‚¬ ì°¾ê¸°
    function getVendors(langCode) {
      const vendors = [];
      for (const [vendor, langs] of Object.entries(VENDOR_DATA)) {
        if (langs.includes(langCode)) {
          vendors.push(vendor);
        }
      }
      return vendors.length > 0 ? vendors.join(', ') : '-';
    }

    // ì–¸ì–´ ì¶”ê°€/ì‚­ì œ ì‹œ ë¹„ì¤‘ ìë™ ì¬ê³„ì‚°
    function recalculatePercentages() {
      if (languages.length === 0) return;
      
      // ì„ íƒëœ ì–¸ì–´ë“¤ì˜ ê¸°ë³¸ ë¹„ì¤‘ í•©ê³„
      const totalBaseRatio = languages.reduce((sum, lang) => {
        const preset = PRESET_LANGUAGES.find(p => p.code === lang.code);
        return sum + (preset ? preset.baseRatio : 10); // ì»¤ìŠ¤í…€ ì–¸ì–´ëŠ” 10ìœ¼ë¡œ
      }, 0);
      
      // 100%ë¡œ ì¬ê³„ì‚°
      languages.forEach(lang => {
        const preset = PRESET_LANGUAGES.find(p => p.code === lang.code);
        const baseRatio = preset ? preset.baseRatio : 10;
        lang.percentage = Math.round((baseRatio / totalBaseRatio) * 100 * 10) / 10;
      });
      
      // ë°˜ì˜¬ë¦¼ ì˜¤ì°¨ ë³´ì •
      const currentTotal = languages.reduce((sum, l) => sum + l.percentage, 0);
      if (currentTotal !== 100 && languages.length > 0) {
        languages[0].percentage += Math.round((100 - currentTotal) * 10) / 10;
      }
    }

    // í˜„ì¬ ì–¸ì–´ ëª©ë¡
    let languages = [];
    
    // ì„ íƒëœ ì–¸ì–´ (ê³„ì‚° ì „ ì„ì‹œ ì €ì¥)
    let selectedLanguages = [];

    // DOM ìš”ì†Œ
    const elements = {
      gameName: document.getElementById('gameName'),
      mau: document.getElementById('mau'),
      ticketRateEarly: document.getElementById('ticketRateEarly'),
      ticketRateStable: document.getElementById('ticketRateStable'),
      ticketsPerDay: document.getElementById('ticketsPerDay'),
      workingDays: document.getElementById('workingDays'),
      earlyTickets: document.getElementById('earlyTickets'),
      stableTickets: document.getElementById('stableTickets'),
      earlyAgents: document.getElementById('earlyAgents'),
      stableAgents: document.getElementById('stableAgents'),
      summaryEarly: document.getElementById('summaryEarly'),
      summaryStable: document.getElementById('summaryStable'),
      changeBadge: document.getElementById('changeBadge'),
      langTotal: document.getElementById('langTotal'),
      languageList: document.getElementById('languageList'),
      langEmpty: document.getElementById('langEmpty'),
      langModal: document.getElementById('langModal'),
      presetTags: document.getElementById('presetTags'),
      customFlag: document.getElementById('customFlag'),
      customName: document.getElementById('customName'),
      referenceSection: document.getElementById('referenceSection'),
      settingsSection: document.getElementById('settingsSection'),
      referenceNote: document.getElementById('referenceNote'),
      aiPlaceholder: document.getElementById('aiPlaceholder'),
      aiLoading: document.getElementById('aiLoading'),
      aiResult: document.getElementById('aiResult'),
      analyzeBtn: document.getElementById('analyzeBtn'),
      baseGame: document.getElementById('baseGame'),
      resultsSection: document.getElementById('resultsSection'),
      langSelectModal: document.getElementById('langSelectModal'),
      langSelectTags: document.getElementById('langSelectTags'),
      langPreview: document.getElementById('langPreview'),
      calculateBtn: document.getElementById('calculateBtn'),
    };

    // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ (ì‰¼í‘œ ì¶”ê°€)
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    // ìˆ«ì íŒŒì‹± í•¨ìˆ˜ (ì‰¼í‘œ ì œê±°)
    function parseNumber(str) {
      return Number(str.replace(/,/g, '')) || 0;
    }

    // MAU ì…ë ¥ ì‹œ ì‰¼í‘œ ìë™ ì¶”ê°€ (ì»¤ì„œ ìœ„ì¹˜ ìœ ì§€)
    function handleMauInput(e) {
      const input = e.target;
      const oldValue = input.value;
      const cursorPos = input.selectionStart;
      
      // ì»¤ì„œ ì•ì— ìˆëŠ” ì‰¼í‘œ ê°œìˆ˜ ì„¸ê¸°
      const commasBeforeCursor = (oldValue.slice(0, cursorPos).match(/,/g) || []).length;
      
      // ì‰¼í‘œ ì œê±°í•˜ê³  ìˆ«ìë§Œ ì¶”ì¶œ
      const numericValue = oldValue.replace(/,/g, '').replace(/[^0-9]/g, '');
      
      if (numericValue === '') {
        input.value = '';
        calculate();
        return;
      }
      
      // ìƒˆ ê°’ í¬ë§·íŒ…
      const newValue = formatNumber(parseInt(numericValue, 10));
      input.value = newValue;
      
      // ì»¤ì„œ ì• ìˆ«ì ê°œìˆ˜ ê³„ì‚° (ì‰¼í‘œ ì œì™¸)
      const digitsBeforeCursor = cursorPos - commasBeforeCursor;
      
      // ìƒˆ ê°’ì—ì„œ í•´ë‹¹ ìˆ«ì ìœ„ì¹˜ ì°¾ê¸°
      let newCursorPos = 0;
      let digitCount = 0;
      for (let i = 0; i < newValue.length; i++) {
        if (newValue[i] !== ',') {
          digitCount++;
        }
        if (digitCount === digitsBeforeCursor) {
          newCursorPos = i + 1;
          break;
        }
      }
      
      // ì»¤ì„œ ìœ„ì¹˜ ë³µì›
      input.setSelectionRange(newCursorPos, newCursorPos);
      calculate();
    }

    // ê³„ì‚° í•¨ìˆ˜
    function calculate() {
      const mau = parseNumber(elements.mau.value);
      config.ticketRateEarly = Number(elements.ticketRateEarly.value) / 100;
      config.ticketRateStable = Number(elements.ticketRateStable.value) / 100;
      config.ticketsPerAgentPerDay = Number(elements.ticketsPerDay.value) || 100;
      config.workingDaysPerMonth = Number(elements.workingDays.value) || 22;

      const ticketsPerMonth = config.ticketsPerAgentPerDay * config.workingDaysPerMonth;

      const earlyTickets = mau * config.ticketRateEarly;
      const stableTickets = mau * config.ticketRateStable;

      // ì „ì²´ í•„ìš” ì¸ì› (ì–¸ì–´ ìƒê´€ì—†ì´)
      const totalEarlyAgentsBase = Math.ceil(earlyTickets / ticketsPerMonth);
      const totalStableAgentsBase = Math.ceil(stableTickets / ticketsPerMonth);

      const totalPercentage = languages.reduce((sum, l) => sum + l.percentage, 0);

      // ì–¸ì–´ë³„ ì¸ì› ê³„ì‚° (ì „ì²´ ì¸ì› ê¸°ì¤€ìœ¼ë¡œ ë°°ë¶„)
      languages.forEach(lang => {
        lang.earlyAgents = totalEarlyAgentsBase * (lang.percentage / 100);
        lang.stableAgents = totalStableAgentsBase * (lang.percentage / 100);
      });

      // UI ì—…ë°ì´íŠ¸ - í•­ìƒ ì „ì²´ í•„ìš” ì¸ì› í‘œì‹œ
      elements.earlyTickets.textContent = Math.round(earlyTickets).toLocaleString();
      elements.stableTickets.textContent = Math.round(stableTickets).toLocaleString();
      elements.earlyAgents.textContent = totalEarlyAgentsBase;
      elements.stableAgents.textContent = totalStableAgentsBase;
      elements.summaryEarly.textContent = totalEarlyAgentsBase + 'ëª…';
      elements.summaryStable.textContent = totalStableAgentsBase + 'ëª…';

      // ë³€í™” ë±ƒì§€
      const diff = totalEarlyAgentsBase - totalStableAgentsBase;
      if (diff > 0) {
        elements.changeBadge.textContent = `${diff}ëª… ì¶•ì†Œ ê°€ëŠ¥`;
        elements.changeBadge.className = 'change-badge positive';
      } else if (diff < 0) {
        elements.changeBadge.textContent = `${Math.abs(diff)}ëª… ì¶”ê°€ í•„ìš”`;
        elements.changeBadge.className = 'change-badge negative';
      } else {
        elements.changeBadge.textContent = 'ë³€ë™ ì—†ìŒ';
        elements.changeBadge.className = 'change-badge positive';
      }

      // í•©ê³„
      elements.langTotal.textContent = `í•©ê³„: ${totalPercentage}%`;
      elements.langTotal.className = totalPercentage === 100 ? 'lang-total valid' : 'lang-total invalid';

      // ì°¸ê³  ë…¸íŠ¸
      elements.referenceNote.textContent = `* í˜„ì¬ ê³„ì‚° ê¸°ì¤€: ëŸ°ì¹­ ì´ˆë°˜ ${(config.ticketRateEarly * 100).toFixed(2)}%, ì•ˆì •ê¸° ${(config.ticketRateStable * 100).toFixed(2)}%, ìƒë‹´ì› 1ì¸ ì¼ ${config.ticketsPerAgentPerDay}ê±´ ì²˜ë¦¬ (ì›” ${config.workingDaysPerMonth}ì¼ ê·¼ë¬´)`;

      renderLanguages();
    }

    // ì–¸ì–´ ëª©ë¡ ë Œë”ë§
    function renderLanguages() {
      if (languages.length === 0) {
        elements.languageList.innerHTML = '';
        elements.langEmpty.classList.remove('hidden');
        return;
      }

      elements.langEmpty.classList.add('hidden');
      elements.languageList.innerHTML = languages.map(lang => `
        <div class="lang-row" data-code="${lang.code}">
          <span class="lang-flag">${lang.flag}</span>
          <span class="lang-name">${lang.name}</span>
          <div class="lang-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${lang.percentage}%;"></div>
            </div>
          </div>
          <span class="lang-percentage-text">${lang.percentage.toFixed(1)}%</span>
          <div class="lang-agents">
            <span class="lang-agents-value green">${(lang.earlyAgents || 0).toFixed(1)}</span>
            <span class="lang-agents-unit">ëª…</span>
          </div>
          <span class="lang-arrow">â†’</span>
          <div class="lang-agents">
            <span class="lang-agents-value blue">${(lang.stableAgents || 0).toFixed(1)}</span>
            <span class="lang-agents-unit">ëª…</span>
          </div>
          <div class="lang-vendor">${getVendors(lang.code)}</div>
          <div class="lang-vendor-agents">${(lang.earlyAgents || 0).toFixed(1)}ëª…â†’${(lang.stableAgents || 0).toFixed(1)}ëª…</div>
        </div>
      `).join('');
    }

    // í”„ë¦¬ì…‹ íƒœê·¸ ë Œë”ë§
    function renderPresetTags() {
      const availablePresets = PRESET_LANGUAGES.filter(p => !languages.find(l => l.code === p.code));
      
      if (availablePresets.length === 0) {
        elements.presetTags.innerHTML = '<div style="color: #9ca3af; font-size: 13px;">ëª¨ë“  í”„ë¦¬ì…‹ ì–¸ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤</div>';
        return;
      }

      elements.presetTags.innerHTML = availablePresets.map(lang => `
        <button class="btn tag" data-code="${lang.code}">${lang.flag} ${lang.name}</button>
      `).join('');

      elements.presetTags.querySelectorAll('.tag').forEach(tag => {
        tag.addEventListener('click', (e) => {
          const code = e.target.dataset.code;
          const preset = PRESET_LANGUAGES.find(p => p.code === code);
          if (preset) {
            languages.push({ ...preset, percentage: 0 });
            recalculatePercentages();
            calculate();
            renderPresetTags();
          }
        });
      });
    }

    // AI ë¶„ì„
    async function analyzeWithClaude() {
      elements.analyzeBtn.disabled = true;
      elements.analyzeBtn.innerHTML = '<span class="spinner"></span> ë¶„ì„ ì¤‘...';
      elements.aiPlaceholder.classList.add('hidden');
      elements.aiLoading.classList.remove('hidden');
      elements.aiResult.classList.add('hidden');

      const mau = Number(elements.mau.value) || 0;
      const gameName = elements.gameName.value;
      const ticketsPerMonth = config.ticketsPerAgentPerDay * config.workingDaysPerMonth;
      const earlyTickets = mau * config.ticketRateEarly;
      const stableTickets = mau * config.ticketRateStable;
      const totalEarlyAgents = languages.reduce((sum, l) => sum + Math.ceil((earlyTickets / ticketsPerMonth) * (l.percentage / 100)), 0);
      const totalStableAgents = languages.reduce((sum, l) => sum + Math.ceil((stableTickets / ticketsPerMonth) * (l.percentage / 100)), 0);

      const langBreakdown = languages.map(lang => {
        const earlyAgents = (earlyTickets / ticketsPerMonth) * (lang.percentage / 100);
        const stableAgents = (stableTickets / ticketsPerMonth) * (lang.percentage / 100);
        const vendor = getVendors(lang.code);
        return `- ${lang.name}: ìœ ì € ë¹„ì¤‘ ${lang.percentage}%, ì´ˆë°˜ ${Math.ceil(earlyAgents)}MM â†’ ì•ˆì •ê¸° ${Math.ceil(stableAgents)}MM, ì™¸ì£¼ì‚¬: ${vendor}`;
      }).join('\n');

      const prompt = `ë‹¹ì‹ ì€ ê²Œì„ CS(ê³ ê°ì§€ì›) ìš´ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ CS ì¸ë ¥ ì‚°ì • ê²°ê³¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.

## ê²Œì„ ì •ë³´
- ê²Œì„ëª…: ${gameName}
- ì˜ˆìƒ MAU: ${mau.toLocaleString()}ëª…

## ê³„ì‚° ê²°ê³¼
- ëŸ°ì¹­ ì´ˆë°˜ (1~2ê°œì›”)
  - ì˜ˆìƒ ì›”ê°„ í‹°ì¼“: ${Math.round(earlyTickets).toLocaleString()}ê±´
  - í•„ìš” ì¸ì›: ${totalEarlyAgents}MM

- ì•ˆì •ê¸° (3ê°œì›” í›„~)
  - ì˜ˆìƒ ì›”ê°„ í‹°ì¼“: ${Math.round(stableTickets).toLocaleString()}ê±´
  - í•„ìš” ì¸ì›: ${totalStableAgents}MM

## ì–¸ì–´ë³„ ë°°ë¶„ ë° ì™¸ì£¼ì‚¬
${langBreakdown}

## ì™¸ì£¼ì‚¬ ì •ë³´
- Meta-M: í•œêµ­ì–´ ì „ë¬¸
- Ubase: ì˜ì–´, ì¸ë„ë„¤ì‹œì•„ì–´, íƒœêµ­ì–´, ë§ë ˆì´ì‹œì•„ì–´, ì¤‘êµ­ì–´ ë²ˆì²´, íŠ€ë¥´í‚¤ì˜ˆì–´, ì•„ëì–´
- Keywords: ì˜ì–´, íŒë””ì–´, ì¼ë³¸ì–´, í”„ë‘ìŠ¤ì–´, ëŸ¬ì‹œì•„ì–´, ìŠ¤í˜ì¸ì–´, í¬ë¥´íˆ¬ê°ˆì–´, ë…ì¼ì–´

## ê³„ì‚° ê¸°ì¤€
- ëŸ°ì¹­ ì´ˆë°˜ í‹°ì¼“ ë°œìƒë¥ : ${(config.ticketRateEarly * 100).toFixed(2)}%
- ì•ˆì •ê¸° í‹°ì¼“ ë°œìƒë¥ : ${(config.ticketRateStable * 100).toFixed(2)}%
- ìƒë‹´ì› 1ì¸ ì¼ ì²˜ë¦¬ëŸ‰: ${config.ticketsPerAgentPerDay}ê±´
- ì›” ê·¼ë¬´ì¼ìˆ˜: ${config.workingDaysPerMonth}ì¼

---

ì•„ë˜ í•­ëª©ë“¤ì„ MM(Man-Month) ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. **MM ë°°ë¶„ ì „ëµ**: ëŸ°ì¹­ ì´ˆë°˜ê³¼ ì•ˆì •ê¸°ì˜ MM ìš´ì˜ ë°©ì•ˆ
2. **ë¦¬ìŠ¤í¬ ë¶„ì„**: í˜„ì¬ ê³„ì‚°ì—ì„œ ê³ ë ¤í•´ì•¼ í•  ë¦¬ìŠ¤í¬ ìš”ì†Œ
3. **MM íš¨ìœ¨í™”**: ì¸ë ¥ íš¨ìœ¨í™”ë¥¼ ìœ„í•œ ì œì•ˆ (MM ê´€ì )
4. **ì–¸ì–´ë³„ ìš´ì˜ íŒ**: ì–¸ì–´ íŠ¹ì„±ê³¼ ë‹´ë‹¹ ì™¸ì£¼ì‚¬ë¥¼ ê³ ë ¤í•œ ìš´ì˜ ì¡°ì–¸
5. **ì™¸ì£¼ì‚¬ í™œìš© ì „ëµ**: ê° ì™¸ì£¼ì‚¬ë³„ ê°•ì ì„ ê³ ë ¤í•œ ë°°ë¶„ ì œì•ˆ

ì£¼ì˜: ì •ê·œì§, ê³„ì•½ì§, íŒŒíŠ¸íƒ€ì„ ë“± ê³ ìš© í˜•íƒœì— ëŒ€í•œ ì œì•ˆì€ í•˜ì§€ ë§ˆì„¸ìš”. ìˆœìˆ˜í•˜ê²Œ MM ê¸°ì¤€ìœ¼ë¡œë§Œ ë¶„ì„í•´ì£¼ì„¸ìš”.

ê°„ê²°í•˜ê³  ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”. í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.`;

      try {
        const response = await fetch("https://komorevee.app.n8n.cloud/webhook/cs-calculator-analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt })
        });

        const data = await response.json();
        const text = data.content?.map(item => item.text || "").join("\n") || "ë¶„ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        
        elements.aiLoading.classList.add('hidden');
        elements.aiResult.textContent = text;
        elements.aiResult.classList.remove('hidden');
      } catch (error) {
        elements.aiLoading.classList.add('hidden');
        elements.aiResult.textContent = "ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message;
        elements.aiResult.classList.remove('hidden');
      } finally {
        elements.analyzeBtn.disabled = false;
        elements.analyzeBtn.innerHTML = 'âœ¨ ê²°ê³¼ ë¶„ì„í•˜ê¸°';
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('toggleSettings').addEventListener('click', () => {
      elements.settingsSection.classList.toggle('show');
      const btn = document.getElementById('toggleSettings');
      btn.textContent = elements.settingsSection.classList.contains('show') ? 'âš™ï¸ ê¸°ì¤€ê°’ ì„¤ì • â–²' : 'âš™ï¸ ê¸°ì¤€ê°’ ì„¤ì • â–¼';
    });

    document.getElementById('toggleReference').addEventListener('click', () => {
      elements.referenceSection.classList.toggle('show');
      const btn = document.getElementById('toggleReference');
      btn.textContent = elements.referenceSection.classList.contains('show') ? 'ğŸ“Š ì°¸ê³  ë°ì´í„° â–²' : 'ğŸ“Š ì°¸ê³  ë°ì´í„° â–¼';
    });

    elements.mau.addEventListener('input', handleMauInput);

    // ê¸°ì¤€ ê²Œì„ ì„ íƒ ì‹œ ë°œìƒë¥  ì—…ë°ì´íŠ¸
    elements.baseGame.addEventListener('change', (e) => {
      const gameData = GAME_DATA[e.target.value];
      if (gameData) {
        config.ticketRateEarly = gameData.earlyRate;
        config.ticketRateStable = gameData.stableRate;
        
        // ê¸°ì¤€ê°’ ì„¤ì • í•„ë“œë„ ì—…ë°ì´íŠ¸
        elements.ticketRateEarly.value = (gameData.earlyRate * 100).toFixed(2);
        elements.ticketRateStable.value = (gameData.stableRate * 100).toFixed(2);
      }
    });

    elements.analyzeBtn.addEventListener('click', analyzeWithClaude);

    // ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('openLangSelect').addEventListener('click', () => {
      elements.langSelectModal.classList.remove('hidden');
      renderLangSelectTags();
    });

    // ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById('closeLangSelectBtn').addEventListener('click', () => {
      elements.langSelectModal.classList.add('hidden');
      updateLangPreview();
    });

    elements.langSelectModal.addEventListener('click', (e) => {
      if (e.target === elements.langSelectModal) {
        elements.langSelectModal.classList.add('hidden');
        updateLangPreview();
      }
    });

    // ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ì—ì„œ ì§ì ‘ ì…ë ¥
    document.getElementById('addCustomSelectBtn').addEventListener('click', () => {
      const name = document.getElementById('customNameSelect').value.trim();
      const flag = document.getElementById('customFlagSelect').value.trim() || 'ğŸ³ï¸';
      if (name) {
        const customLang = {
          code: `custom-${Date.now()}`,
          name,
          flag,
          baseRatio: 10
        };
        selectedLanguages.push(customLang);
        document.getElementById('customNameSelect').value = '';
        document.getElementById('customFlagSelect').value = 'ğŸ³ï¸';
        renderLangSelectTags();
        updateLangPreview();
      }
    });

    // ê³„ì‚°í•˜ê¸° ë²„íŠ¼
    elements.calculateBtn.addEventListener('click', () => {
      // ì„ íƒëœ ì–¸ì–´ë¥¼ languagesì— ë³µì‚¬í•˜ê³  ë¹„ì¤‘ ê³„ì‚°
      languages = selectedLanguages.map(lang => ({
        code: lang.code,
        name: lang.name,
        flag: lang.flag,
        percentage: 0
      }));
      
      if (languages.length > 0) {
        recalculatePercentages();
      }
      
      // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
      elements.resultsSection.classList.remove('hidden');
      
      // ê³„ì‚° ì‹¤í–‰
      calculate();
      
      // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
    });

    // ì–¸ì–´ ì„ íƒ íƒœê·¸ ë Œë”ë§
    function renderLangSelectTags() {
      elements.langSelectTags.innerHTML = PRESET_LANGUAGES.map(lang => {
        const isSelected = selectedLanguages.some(l => l.code === lang.code);
        return `<button class="lang-select-tag ${isSelected ? 'selected' : ''}" data-code="${lang.code}">${lang.flag} ${lang.name}</button>`;
      }).join('');

      // ì»¤ìŠ¤í…€ ì–¸ì–´ë„ í‘œì‹œ
      selectedLanguages.filter(l => l.code.startsWith('custom-')).forEach(lang => {
        elements.langSelectTags.innerHTML += `<button class="lang-select-tag selected" data-code="${lang.code}">${lang.flag} ${lang.name}</button>`;
      });

      // í´ë¦­ ì´ë²¤íŠ¸
      elements.langSelectTags.querySelectorAll('.lang-select-tag').forEach(tag => {
        tag.addEventListener('click', (e) => {
          const code = e.target.dataset.code;
          const isSelected = selectedLanguages.some(l => l.code === code);
          
          if (isSelected) {
            selectedLanguages = selectedLanguages.filter(l => l.code !== code);
          } else {
            const preset = PRESET_LANGUAGES.find(p => p.code === code);
            if (preset) {
              selectedLanguages.push({ ...preset });
            }
          }
          
          renderLangSelectTags();
          updateLangPreview();
        });
      });
    }

    // ì„ íƒëœ ì–¸ì–´ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateLangPreview() {
      if (selectedLanguages.length === 0) {
        elements.langPreview.textContent = 'ì„ íƒëœ ì–¸ì–´ ì—†ìŒ';
      } else {
        const names = selectedLanguages.map(l => l.name).join(', ');
        elements.langPreview.textContent = `${names} (${selectedLanguages.length}ê°œ)`;
      }
    }

    // ì´ˆê¸°í™” - ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¹€
    elements.resultsSection.classList.add('hidden');
    updateLangPreview();
  </script>
</body>
</html>
